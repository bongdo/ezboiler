(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[694],{4874:(e,r,a)=>{Promise.resolve().then(a.bind(a,7068))},7068:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>w});var t=a(5155),i=a(9904),s=a(8698),l=a(12);let n=(0,i.Wp)({apiKey:"AIzaSyCagZ1Cp8ylQOwHGINdce-1Tf5VDwlkszM",authDomain:"ezbioler-ru.firebaseapp.com",databaseURL:"https://ezbioler-ru-default-rtdb.europe-west1.firebasedatabase.app",projectId:"ezbioler-ru",storageBucket:"ezbioler-ru.firebasestorage.app",messagingSenderId:"615257263042",appId:"1:615257263042:web:c11b626dfac771176c645b"}),o=(0,s.C3)(n),d=(0,l.xI)(n),c=(0,s.KR)(o);function u(e){return e?Array.isArray(e)?e.filter(e=>null!=e):Object.values(e):[]}async function p(){console.warn("Using fallback data from products.json");try{let e=await fetch("/products.json");if(!e.ok)throw Error("Fallback fetch failed");return e.json()}catch(e){throw console.error("Client fallback error",e),e}}async function h(){try{d.currentUser||await (0,l.zK)(d);let[e,r,a,t,i]=await Promise.all([(0,s.Jt)((0,s.jf)(c,"parts")),(0,s.Jt)((0,s.jf)(c,"part_types")),(0,s.Jt)((0,s.jf)(c,"brands")),(0,s.Jt)((0,s.jf)(c,"boilers")),(0,s.Jt)((0,s.jf)(c,"parts_boilers"))]),n=u(e.val()),o=u(r.val()),p=u(a.val()),h=u(t.val()),m=u(i.val()),g=new Map(o.map(e=>[e.id,e.name])),x=new Map(p.map(e=>[e.id,e.name])),f=new Map(h.map(e=>[e.id,e])),b=new Map,_=new Map;return m.forEach(e=>{var r,a;_.has(e.part_code)||_.set(e.part_code,new Set),null===(r=_.get(e.part_code))||void 0===r||r.add(e.boiler_id);let t=f.get(e.boiler_id);t&&(b.has(e.part_code)||b.set(e.part_code,[]),null===(a=b.get(e.part_code))||void 0===a||a.push(t.name))}),{products:n.map(e=>({vendor_code:e.vendor_code,name:e.name,description:e.description,price:e.price,quantity:e.quantity,image:e.image,part_type:g.get(e.part_type_id)||"",original_brand_id:e.original_brand_id,original_brand:e.original_brand_id?x.get(e.original_brand_id):void 0,in_price_list:e.in_price_list,compatible_boilers:b.get(e.vendor_code)||[],_boiler_ids:_.get(e.vendor_code)||new Set,_part_type_id:e.part_type_id,_is_used:1===e.is_used,_is_original:!!e.original_brand_id})),filters:{part_types:o,brands:p,boilers:h}}}catch(r){console.error("Firebase fetch error, retrying with fallback...",r);let e=await p();return{products:e.products.map(e=>({...e,_boiler_ids:new Set(e._boiler_ids||[])})),filters:e.filters}}}async function m(e){try{let{products:r}=await h(),a=r;if(e){if(e.q){let r=e.q.toLowerCase();a=a.filter(e=>e.name.toLowerCase().includes(r)||e.vendor_code.toLowerCase().includes(r)||e.original_brand&&e.original_brand.toLowerCase().includes(r))}e.type_id&&(a=a.filter(r=>r._part_type_id===e.type_id)),e.boiler_id&&(a=a.filter(r=>r._boiler_ids.has(e.boiler_id))),void 0!==e.is_used&&(a=a.filter(r=>r._is_used===e.is_used)),void 0!==e.is_original&&(a=e.is_original?a.filter(e=>!!e.original_brand_id):a.filter(e=>!e.original_brand_id))}let t=(null==e?void 0:e.limit)||50,i=(null==e?void 0:e.offset)||0;return a.slice(i,i+t)}catch(e){return console.error("Error fetching products",e),[]}}async function g(){try{let{filters:e}=await h();return e}catch(e){return console.error(e),{part_types:[],brands:[],boilers:[]}}}var x=a(7396),f=a(1584),b=a(8474);function _(e){let{product:r}=e,{addItem:a}=(0,f._)(),i=r.image||null,s=!!r.original_brand,l={text:"В наличии",color:"text-green-600 border-green-600"};return r.quantity<=0&&(l=1===r.in_price_list?{text:"Под заказ (7 дней)",color:"text-yellow-600 border-yellow-600"}:{text:"Под заказ",color:"text-red-600 border-red-600"}),(0,t.jsxs)("div",{className:"group bg-white rounded-lg shadow-sm hover:shadow-md transition overflow-hidden border flex flex-col h-full relative",children:[(0,t.jsxs)(x.default,{href:"/product/".concat(r.vendor_code),className:"block flex-grow",children:[(0,t.jsxs)("div",{className:"aspect-square relative bg-gray-100",children:[i?(0,t.jsx)("img",{src:i,alt:r.name,className:"object-cover w-full h-full group-hover:scale-105 transition"}):(0,t.jsx)("div",{className:"flex items-center justify-center h-full text-gray-400 text-xs",children:"No Image"}),(0,t.jsxs)("div",{className:"absolute top-2 left-2 flex flex-col gap-1",children:[(0,t.jsx)("span",{className:"text-[10px] font-bold px-2 py-0.5 rounded border bg-white ".concat(s?"text-blue-600 border-blue-600":"text-gray-600 border-gray-400"),children:s?"Оригинал":"Аналог"}),(0,t.jsx)("span",{className:"text-[10px] font-bold px-2 py-0.5 rounded border bg-white ".concat(l.color),children:l.text})]})]}),(0,t.jsxs)("div",{className:"p-4 flex flex-col gap-2",children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 line-clamp-2 group-hover:text-primary transition text-sm h-10",children:r.name}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["Арт: ",r.vendor_code]}),(0,t.jsxs)("p",{className:"text-lg font-bold text-primary",children:[r.price.toLocaleString("ru-RU")," ₽"]})]})]}),(0,t.jsx)("div",{className:"px-4 pb-4 mt-auto",children:(0,t.jsxs)("button",{onClick:e=>{e.preventDefault(),a(r)},className:"w-full flex items-center justify-center gap-2 bg-gray-100 hover:bg-primary hover:text-white text-gray-700 py-2 rounded-lg transition text-sm font-medium",children:[(0,t.jsx)(b.A,{className:"w-4 h-4"}),"В корзину"]})})]})}var v=a(2115),j=a(6046);function y(){var e;let[r,a]=(0,v.useState)([]),[i,s]=(0,v.useState)(null),[l,n]=(0,v.useState)(!0),[o,d]=(0,v.useState)(0),[c,u]=(0,v.useState)(!0),p=(0,j.useSearchParams)(),h=(0,j.useRouter)(),x=p.get("q")||"",f=p.get("type_id"),b=p.get("boiler_id"),y=p.get("is_used"),w=p.get("is_original"),N=p.get("brand"),C=p.get("model");(0,v.useEffect)(()=>{a([]),d(0),u(!0),n(!0)},[x,f,b,y,w,N,C]),(0,v.useEffect)(()=>{(async()=>{try{let e=i;e||(e=await g(),s(e));let r=b?Number(b):void 0;if(!r&&C&&e){let a=e.boilers.find(e=>e.name===C);a&&(r=a.id)}let t=await m({q:x,type_id:f?Number(f):void 0,boiler_id:r,is_used:"true"===y||"false"!==y&&void 0,is_original:"true"===w||"false"!==w&&void 0,limit:50,offset:o});t.length<50&&u(!1),a(e=>0===o?t:[...e,...t])}catch(e){console.error(e)}finally{n(!1)}})()},[x,f,b,y,w,N,C,o]);let k=(e,r)=>{let a=new URLSearchParams(p.toString());r?a.set(e,r):a.delete(e),a.delete("offset"),h.push("/catalog?".concat(a.toString()))},S=null==i?void 0:null===(e=i.boilers.find(e=>e.id===Number(b)))||void 0===e?void 0:e.name;return l&&0===r.length?(0,t.jsx)("div",{className:"container mx-auto p-8",children:"Loading..."}):(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-8",children:S?"Каталог запчастей для ".concat(S):"Каталог запчастей"}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-8",children:[(0,t.jsxs)("div",{className:"w-full md:w-64 flex-shrink-0 space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-100",children:[(0,t.jsx)("h3",{className:"font-bold mb-3",children:"Тип запчасти"}),(0,t.jsxs)("select",{className:"w-full p-2 border rounded",value:f||"",onChange:e=>k("type_id",e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Все типы"}),null==i?void 0:i.part_types.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-100",children:[(0,t.jsx)("h3",{className:"font-bold mb-3",children:"Совместимость с котлом"}),(0,t.jsxs)("select",{className:"w-full p-2 border rounded",value:b||"",onChange:e=>k("boiler_id",e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Все модели"}),null==i?void 0:i.boilers.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-100",children:[(0,t.jsx)("h3",{className:"font-bold mb-3",children:"Состояние"}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"radio",name:"is_used",checked:!y,onChange:()=>k("is_used","")}),(0,t.jsx)("span",{children:"Любое"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"radio",name:"is_used",checked:"false"===y,onChange:()=>k("is_used","false")}),(0,t.jsx)("span",{children:"Новое"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"radio",name:"is_used",checked:"true"===y,onChange:()=>k("is_used","true")}),(0,t.jsx)("span",{children:"Б/У"})]})]})]}),(0,t.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-100",children:[(0,t.jsx)("h3",{className:"font-bold mb-3",children:"Происхождение"}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"radio",name:"is_original",checked:!w,onChange:()=>k("is_original","")}),(0,t.jsx)("span",{children:"Любое"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"radio",name:"is_original",checked:"true"===w,onChange:()=>k("is_original","true")}),(0,t.jsx)("span",{children:"Оригинал"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"radio",name:"is_original",checked:"false"===w,onChange:()=>k("is_original","false")}),(0,t.jsx)("span",{children:"Аналог"})]})]})]})]}),(0,t.jsx)("div",{className:"flex-grow",children:0===r.length?(0,t.jsx)("div",{className:"text-center py-12 text-gray-500",children:"Товары не найдены"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:r.map(e=>(0,t.jsx)(_,{product:e},e.vendor_code))}),c&&(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("button",{onClick:()=>{d(e=>e+50)},disabled:l,className:"bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-bold py-3 px-8 rounded-full transition",children:l?"Загрузка...":"Загрузить еще"})})]})})]})]})}function w(){return(0,t.jsx)(v.Suspense,{fallback:(0,t.jsx)("div",{className:"container mx-auto p-8",children:"Loading..."}),children:(0,t.jsx)(y,{})})}},1584:(e,r,a)=>{"use strict";a.d(r,{_:()=>n,e:()=>l});var t=a(5155),i=a(2115);let s=(0,i.createContext)(void 0);function l(e){let{children:r}=e,[a,l]=(0,i.useState)([]);(0,i.useEffect)(()=>{let e=localStorage.getItem("cart");if(e)try{l(JSON.parse(e))}catch(e){console.error("Failed to parse cart",e)}},[]),(0,i.useEffect)(()=>{localStorage.setItem("cart",JSON.stringify(a))},[a]);let n=a.reduce((e,r)=>e+r.price*r.quantity,0);return(0,t.jsx)(s.Provider,{value:{items:a,addItem:e=>{l(r=>r.find(r=>r.vendor_code===e.vendor_code)?r.map(r=>r.vendor_code===e.vendor_code?{...r,quantity:r.quantity+1}:r):[...r,{...e,quantity:1}])},removeItem:e=>{l(r=>r.filter(r=>r.vendor_code!==e))},clearCart:()=>l([]),total:n},children:r})}function n(){let e=(0,i.useContext)(s);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}}},e=>{var r=r=>e(e.s=r);e.O(0,[878,595,839,501,441,517,358],()=>r(4874)),_N_E=e.O()}]);